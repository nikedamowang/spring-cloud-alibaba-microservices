# 订单服务配置 - 修复Redisson配置问题
# DataID: order-service.properties
# Group: DEFAULT_GROUP

# 服务基础配置
spring.application.name=order-service
server.port=8000

# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/demo?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 连接池配置
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.max-lifetime=1200000

# MyBatis Plus配置（修复版本）
mybatis-plus.mapper-locations=classpath*:/mapper/**/*.xml
mybatis-plus.type-aliases-package=com.cloudDemo.orderservice.entity
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.configuration.cache-enabled=true
mybatis-plus.configuration.log-impl=org.apache.ibatis.logging.stdout.StdOutImpl
mybatis-plus.global-config.db-config.id-type=auto
mybatis-plus.global-config.db-config.table-underline=true
mybatis-plus.global-config.db-config.logic-delete-field=deleted
mybatis-plus.global-config.db-config.logic-delete-value=1
mybatis-plus.global-config.db-config.logic-not-delete-value=0

# Dubbo配置（订单服务作为消费者，修复端口冲突）
dubbo.application.name=order-service
dubbo.registry.address=nacos://127.0.0.1:8848
dubbo.protocol.name=dubbo
dubbo.protocol.port=20882
dubbo.application.qos-enable=false
dubbo.scan.base-packages=com.cloudDemo.orderservice.service.impl

# Dubbo消费者配置（负载均衡优化）
dubbo.consumer.timeout=5000
dubbo.consumer.retries=2
dubbo.consumer.check=false
dubbo.consumer.loadbalance=roundrobin
dubbo.consumer.cluster=failover
dubbo.consumer.sticky=false
dubbo.consumer.lazy=false

# 特定服务的负载均衡配置
dubbo.reference.com.cloudDemo.api.service.UserService.loadbalance=roundrobin
dubbo.reference.com.cloudDemo.api.service.UserService.cluster=failover
dubbo.reference.com.cloudDemo.api.service.UserService.timeout=5000
dubbo.reference.com.cloudDemo.api.service.UserService.retries=2

# Redis配置（订单服务缓存）
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.database=1
spring.redis.lettuce.pool.max-active=200
spring.redis.lettuce.pool.max-wait=-1ms
spring.redis.lettuce.pool.max-idle=10
spring.redis.lettuce.pool.min-idle=0
spring.redis.timeout=2000ms

# Redisson配置（直接在properties中配置，避免YAML解析问题）
spring.redis.redisson.database=1
spring.redis.redisson.host=localhost
spring.redis.redisson.port=6379
spring.redis.redisson.timeout=3000
spring.redis.redisson.connection-pool-size=64
spring.redis.redisson.connection-minimum-idle-size=10
spring.redis.redisson.subscription-connection-pool-size=50
spring.redis.redisson.subscription-connection-minimum-idle-size=1

# 缓存配置
spring.cache.type=redis
spring.cache.redis.time-to-live=300000
spring.cache.redis.cache-null-values=true

# Sentinel 熔断降级配置（完整增强版本）
spring.cloud.sentinel.transport.dashboard=localhost:8090
spring.cloud.sentinel.transport.port=8719
spring.cloud.sentinel.filter.enabled=true
spring.cloud.sentinel.eager=true
spring.cloud.sentinel.log.dir=logs/sentinel
spring.cloud.sentinel.metric.file-single-size=52428800
spring.cloud.sentinel.metric.file-total-count=6
spring.cloud.sentinel.web-context-unify=false
spring.cloud.sentinel.transport.heartbeat-interval-ms=5000

# Nacos配置
spring.cloud.nacos.discovery.server-addr=localhost:8848
spring.cloud.nacos.config.server-addr=localhost:8848
spring.cloud.nacos.config.file-extension=properties

# 日志配置（优化版 - 只输出必要信息）
logging.level.com.cloudDemo.orderservice=INFO
logging.level.com.cloudDemo.api=INFO
logging.level.org.apache.dubbo=WARN
logging.level.org.springframework=WARN
logging.level.org.springframework.web=WARN
logging.level.org.springframework.cloud=WARN
logging.level.org.springframework.boot=WARN
logging.level.com.alibaba.cloud.sentinel=WARN
logging.level.com.alibaba.nacos=WARN
logging.level.com.baomidou.mybatisplus=INFO
logging.level.org.mybatis=INFO
logging.level.com.zaxxer.hikari=WARN
logging.level.org.springframework.data.redis=WARN
logging.level.io.lettuce.core=WARN
logging.level.org.redisson=INFO

# 文件日志配置
logging.file.name=logs/order-service.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.total-size-cap=100MB
